# makefile for compiling programs to do worldline calculations
#------------------------------------------------------------------------------------------------------------------------
# configuration

DDIR			= db/nr/plots
PDIR			= pics/nr/db
PLOTTER			= tools/plotSimple.sh
EXE				= bash $(PLOTTER)

#------------------------------------------------------------------------------------------------------------------------
# local variables

CSVS 			= $(wildcard $(DDIR)/*.csv)
DATA 			= $(patsubst  $(DDIR)/%.csv,$(DDIR)/%.dat,$(CSVS))
PNGS	 		= $(patsubst  $(DDIR)/%.csv,$(PDIR)/%.png,$(CSVS))
SVGS			= $(patsubst  $(DDIR)/%.csv,$(PDIR)/%.svg,$(CSVS))

.PHONY : variables
variables :
	@echo CSVS: $(CSVS)
	@echo DATA: $(DATA)
	@echo PNGS: $(PNGS)
	@echo SVGS: $(SVGS)

#------------------------------------------------------------------------------------------------------------------------
# some useful PHONYs

.PHONY: all
all: pngs svgs data

.PHONY: pngs
pngs: $(PNGS) $(DATA)

.PHONY: svgs
svgs: $(SVGS) $(DATA)

.PHONY: data
data: $(DATA)
	
#------------------------------------------------------------------------------------------------------------------------
# generic rules

$(DDIR)/%.dat: $(DDIR)/%.csv
	sed -n 's/"\([0-9.]*\)"/\1/pg' $< >$@
	sed -i 's/,/ /g' $@

$(PDIR)/%.png: $(DDIR)/%.dat $(PLOTTER)
	$(EXE) -o $@ $<
	
$(PDIR)/%.svg: $(DDIR)/%.dat $(PLOTTER)
	$(EXE) -o $@ $<

#------------------------------------------------------------------------------------------------------------------------
# clean
	
.PHONY: clean
clean:
	rm -f $(DDIR)/*.dat
	rm -f $(PDIR)/*.png
	rm -f $(PDIR)/*.svg

